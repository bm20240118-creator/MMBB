<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MMBB2.2</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" type="image/png" href="icon.png">
<style>
:root { --main-pink: #ff8fa3; --bg-soft: #fff5f6; --text-gray: #666; --task-done: #e8f5e9; --soft-blue: #8fa3ff; }
body { background: var(--bg-soft); font-family: -apple-system, "PingFang SC", sans-serif; text-align: center; padding: 20px; color: #444; margin: 0; padding-bottom: 60px; }
.card { background: white; border-radius: 25px; padding: 20px; margin: 15px 0; box-shadow: 0 8px 20px rgba(0,0,0,0.03); position: relative; }
.temp-text { font-size: 48px; color: var(--main-pink); font-weight: bold; margin: 5px 0; }
.mood-box { display: flex; justify-content: space-around; margin: 20px 0; }
.mood-btn { font-size: 32px; border: none; background: white; border-radius: 18px; padding: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); cursor: pointer; transition: 0.3s; }
.mood-btn:active { transform: scale(0.9); background: #fff0f3; }
#secret-msg { border-left: 6px solid var(--main-pink); text-align: left; padding: 15px; background: #fff; line-height: 1.6; }
.btn-checkin { background: var(--main-pink); color: white; border: none; width: 100%; padding: 15px; border-radius: 18px; font-size: 16px; font-weight: bold; transition: 0.3s; cursor: pointer; }
.btn-checkin:disabled { background: #ccc !important; cursor: not-allowed; opacity: 0.8; }
.task-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; margin: 8px 0; background: #fafafa; border-radius: 15px; border: 1px solid #f0f0f0; transition: 0.3s; }
.task-item.done { background: var(--task-done); border-color: #c8e6c9; }
.task-checkbox { width: 22px; height: 22px; accent-color: var(--main-pink); }
.msg-input { width: 100%; border: 1px solid #eee; border-radius: 15px; padding: 12px; font-size: 14px; margin-bottom: 10px; outline: none; resize: none; font-family: inherit; box-sizing: border-box; }
.btn-send { background: var(--soft-blue); color: white; border: none; padding: 12px; border-radius: 15px; font-weight: bold; width: 100%; cursor: pointer; transition: 0.3s; }
.progress-container { background: #eee; height: 12px; border-radius: 10px; margin: 15px 0; overflow: hidden; }
.progress-bar { background: var(--main-pink); height: 100%; transition: width 0.8s ease; }
#status-tip { font-size: 12px; margin-top: 8px; height: 18px; font-weight: bold; transition: 0.3s; opacity: 0; }
#gift-modal, #xmas-video-modal, #comfort-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; justify-content:center; align-items:center; }
.modal-content { background:white; padding:25px; border-radius:30px; max-width:85%; text-align:center; }
/* å½±ç‰‡å½ˆçª—å°ˆç”¨èƒŒæ™¯ */
#xmas-video-modal, #comfort-modal { background: rgba(0,0,0,0.95); z-index: 10000; flex-direction: column; }
</style>
</head>
<body>
<h2 id="greeting" style="margin-top: 20px; color: var(--main-pink); cursor: pointer; transition: 0.3s;">åŒæ­¥é©šå–œä¸­...</h2>

<div class="card">
    <div style="font-size: 13px; color: var(--text-gray);"> ğŸ“ ä¸Šæµ·å¸‚å³æ™‚æ°£è±¡</div>
    <div id="temp" class="temp-text">--Â°</div>
    <div id="weather-desc" style="font-size: 18px; font-weight: bold;">é€£ç·šä¸­...</div>
    <div id="wear-tip" style="font-size: 13px; color: var(--text-gray); margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee;"></div>
</div>

<div class="card" id="secret-msg">
    <div style="font-size: 12px; color: var(--main-pink); font-weight: bold; margin-bottom: 8px;"> ğŸ”’ å•µå•µçš„æ‚„æ‚„è©±ï¼š</div>
    <div id="msg-text"> ğŸŒŸ æ–°åŠŸèƒ½:ã€Œä¸å“­ä¸å“­ã€æ¨¡å¼ï¼šå¿ƒæƒ…ä¸å¥½é»æ“Š ğŸ˜«ï¼Œæœƒæœ‰å°ˆå±¬æŠ±æŠ±å½±ç‰‡å’Œä¸€éµå‘¼å«æˆ‘çš„åŠŸèƒ½ï¼
        æ‚„æ‚„è©±æš—è™Ÿï¼šåœ¨ç•™è¨€æ¡†è¼¸å…¥æˆ‘å€‘ä¹‹é–“çš„ã€Œç¥ç¥•æš—è™Ÿã€ï¼Œå¯ä»¥é ˜å–éš±è—çš„ç”œèœœç©åˆ†ã€‚
        é‹æ°£å¤§è€ƒé©—ï¼šç°½åˆ°ç¾åœ¨æœ‰æ©Ÿæœƒè§¸ç™¼ã€ŒåŠ å€çå‹µã€ï¼›ç©åˆ†å…Œæ›ä¹Ÿå‡ç´šæˆéš¨æ©Ÿé©šå–œæŠ½ç!!!(æœ‰å¤§ä¸­å°çè·Ÿä¸€å€‹ç‰¹ç´šç!!)
        ğŸ› ï¸ è²¼å¿ƒå„ªåŒ–:ç©åˆ†æ›´å…¬å¹³ï¼šå…Œæ›ç¦®ç‰©å¾Œï¼Œå‰©ä¸‹çš„é»æ•¸æœƒå¥½å¥½å­˜è‘—ï¼Œä¸æœƒå†å…¨éƒ¨æ­¸é›¶äº†ã€‚~~ â¤ï¸ </div>
</div>

<div class="mood-box">
    <button class="mood-btn" onclick="sendMood('love')"> â¤ï¸ </button>
    <button class="mood-btn" onclick="sendMood('sad')"> ğŸ˜« </button>
    <button class="mood-btn" onclick="sendMood('happy')"> ğŸ˜Š </button>
</div>

<div class="card">
    <div style="font-size: 15px; font-weight: bold;"> ğŸ’– ç”œèœœé»æ•¸ï¼š<span id="points">0</span>/10</div>
    <div class="progress-container"><div id="p-bar" class="progress-bar" style="width: 0%;"></div></div>
    <button class="btn-checkin" id="checkin-btn" onclick="doCheckIn()">æ¯æ—¥ç°½åˆ°é ˜é©šå–œ</button>
    <div id="status-tip"></div>
</div>

<div class="card">
    <div style="font-size: 16px; font-weight: bold; margin-bottom: 12px; color: #555;"> ğŸ“… ä»Šæ—¥å¥åº·ä»»å‹™ <span style="font-size: 11px; color: var(--main-pink); border: 1px solid; padding: 1px 4px; border-radius: 4px;">çå‹µ +1é»</span></div>
    <div id="task-list">
        <div class="task-item" id="t1"><span>1. è¶…ç´šæ„›å•µå•µ â¤ï¸ </span><input type="checkbox" class="task-checkbox" onclick="toggleTask(1)"></div>
        <div class="task-item" id="t2"><span>2. ç¶­Cåƒåƒåƒ ğŸ’Š </span><input type="checkbox" class="task-checkbox" onclick="toggleTask(2)"></div>
        <div class="task-item" id="t3"><span>3. ä¹–ä¹–å»å¤§ä¾¿ ğŸ’© </span><input type="checkbox" class="task-checkbox" onclick="toggleTask(3)"></div>
    </div>
</div>

<div class="card">
    <div style="font-size: 16px; font-weight: bold; margin-bottom: 12px; color: #555;"> ğŸ’Œ çµ¦å•µå•µç•™è¨€~</div>
    <textarea id="user-msg" class="msg-input" placeholder="æœ‰ä»€éº¼æ‚„æ‚„è©±æƒ³è·Ÿæˆ‘èªªå—..." rows="3"></textarea>
    <button class="btn-send" onclick="sendMessage()">é€å‡ºç•™è¨€</button>
</div>

<div id="gift-modal">
    <div class="modal-content">
        <h3 id="modal-title" style="color:var(--main-pink);"> ğŸ’– æˆåŠŸï¼ ğŸ’– </h3>
        <img id="modal-img" src="gift.jpg" style="width:100%; border-radius:20px; margin-bottom:15px; object-fit: cover;">
        <p id="gift-datetime" style="font-size:12px; color:#999;"></p>
        <p id="modal-desc" style="font-size:16px; font-weight:bold;">è«‹æˆªåœ–ç™¼çµ¦å•µå•µï¼</p>
        <button onclick="document.getElementById('gift-modal').style.display='none'" style="background:var(--main-pink); color:white; border:none; padding:12px 35px; border-radius:15px; cursor:pointer;">å¥½å™ ï¼</button>
    </div>
</div>

<div id="xmas-video-modal">
    <div style="width:90%; position:relative; text-align:center;">
        <h2 style="color:white; margin-bottom:15px;">ğŸ„ è–èª•å¿«æ¨‚ ğŸ„</h2>
        <video id="xmas-video" style="width:100%; border-radius:15px; box-shadow:0 0 30px rgba(255,143,163,0.5);" playsinline>
            <source src="xmas_video.mp4" type="video/mp4">
        </video>
        <button onclick="closeXmasVideo()" style="margin-top:25px; background:var(--main-pink); color:white; border:none; padding:12px 40px; border-radius:20px; font-weight:bold; font-size:16px; cursor:pointer;">æ”¶ä¸‹é©šå–œ ğŸ</button>
    </div>
</div>

<div id="comfort-modal">
    <div style="width:90%; text-align:center;">
        <h2 style="color:white; margin-bottom:5px; text-shadow: 0 0 10px var(--main-pink);"> ğŸ¥º ä¸å“­ä¸å“­ï¼Œæˆ‘åœ¨é€™ï¼</h2>
        <p style="color:rgba(255,255,255,0.8); font-size:12px; margin-bottom:15px;">(è¨˜å¾—æ‰“é–‹è²éŸ³å–” ğŸ”Š)</p>
        <video id="comfort-video" style="width:100%; border-radius:20px; box-shadow:0 0 30px rgba(143,163,255,0.6);" playsinline>
            <source src="hug.mp4" type="video/mp4">
        </video>
        <div style="margin-top:25px; display:flex; justify-content:center; gap:15px;">
            <button onclick="closeComfort()" style="background:var(--main-pink); color:white; border:none; padding:12px 30px; border-radius:20px; font-weight:bold; font-size:16px; cursor:pointer;"> ğŸ˜¤ è¢«æ²»ç™’äº†ï¼</button>
            <button onclick="requestCall()" style="background:white; color:var(--text-gray); border:none; padding:12px 20px; border-radius:20px; font-weight:bold; font-size:14px; cursor:pointer;"> ğŸ“ æƒ³è¦ä½ æ‰“çµ¦æˆ‘</button>
        </div>
    </div>
</div>

<script>
const TOPIC = 'mmbb_love_0118';
let tasks = [false, false, false];

async function init() {
    setGreeting(); 
    updatePointsDisplay(); 
    getWeather(); 
    resetTasksIfNewDay(); 
    checkXmas(); 
}

function checkXmas() {
    const now = new Date();
    if (now.getMonth() === 11 && now.getDate() === 25) {
        showXmasVideo();
    }
}

function showXmasVideo() {
    const modal = document.getElementById('xmas-video-modal');
    const video = document.getElementById('xmas-video');
    modal.style.display = 'flex';
    video.play().catch(() => { video.muted = true; video.play(); });
    localStorage.setItem('xmas_2025_viewed', 'true');
}

function closeXmasVideo() {
    const video = document.getElementById('xmas-video');
    video.pause();
    document.getElementById('xmas-video-modal').style.display = 'none';
}

function setGreeting() {
    const hour = new Date().getHours();
    let g = "è‡­å¯¶ï¼æ—©å®‰å‘€~~ â˜€ï¸ ";
    if(hour >= 12 && hour < 18) g = "åˆå®‰ï¼Œè‡­å¯¶ï¼ ğŸµ ";
    if(hour >= 18) g = "æ™šå®‰~æˆ‘æ„›ä½  ğŸŒ™ ";
    document.getElementById('greeting').innerText = g;
}

// å¤©æ°£ç³»çµ±
async function getWeather() {
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), 5000);

    try {
        const res = await fetch('https://wttr.in/Shanghai?format=j1', { signal: controller.signal });
        clearTimeout(id);
        const data = await res.json();
        const current = data.current_condition[0];
        const tempC = parseInt(current.temp_C);
        
        document.getElementById('temp').innerText = tempC + 'Â°';
        const desc = current.lang_zh ? current.lang_zh[0].value : current.weatherDesc[0].value;
        document.getElementById('weather-desc').innerText = desc;
        
        let tip = "ç©¿å¦³æƒ³ç©¿çš„!!!ç¾ç¾å‡ºé–€ï¼ âœ¨ ";
        if(tempC < 10) tip = "è¶…å†·ï¼æ£‰æœå’Œç¾½çµ¨å¤–å¥—ä¸€å®šè¦ç©¿å–” â„ï¸ ";
        else if(tempC < 16) tip = "å¤©æœ‰é»æ¶¼ï¼Œç©¿å€‹å¤§è¡£æˆ–åšå¤–å¥—æ¯”è¼ƒä¿éšªã€‚ ğŸ§¥ ";
        else if(tempC < 22) tip = "å¤©æ°£èˆ’é©~~ç©¿é•·è¢–æˆ–è–„å¤–å¥—å°±å¯ä»¥äº†å“¦ã€‚ ğŸ‚ ";
        document.getElementById('wear-tip').innerHTML = "<b> ğŸ’¡ ç©¿æ­æé†’ï¼š</b>" + tip;
    } catch(e) {
        document.getElementById('temp').innerText = "--Â°";
        document.getElementById('weather-desc').innerText = "è¨Šè™Ÿå¾®å¼±ï¼Œä½†æˆ‘æ„›å¦³ä¸è®Š â¤ï¸";
    }
}

function showModal(title, desc, imgSrc) {
    document.getElementById('modal-title').innerText = title;
    document.getElementById('modal-desc').innerText = desc;
    document.getElementById('modal-img').src = imgSrc;
    document.getElementById('gift-datetime').innerText = "æ™‚é–“ï¼š" + new Date().toLocaleString();
    document.getElementById('gift-modal').style.display = 'flex';
}

// å¿ƒæƒ…é‚è¼¯
function sendMood(type) {
    let m = 'æƒ³ä½ å›‰ â¤ï¸ ';
    if(type === 'sad') {
        const modal = document.getElementById('comfort-modal');
        const video = document.getElementById('comfort-video');
        modal.style.display = 'flex';
        video.play().catch(() => { video.muted = true; video.play(); });
        sendNotification('mood', ' ğŸš¨ è­¦å ±ï¼è‡­å¯¶å¿ƒæƒ…ä¸å¥½ï¼Œå•Ÿå‹•ç·Šæ€¥å®‰æ…°æ¨¡å¼ï¼ ğŸš¨ ');
        return;
    }
    
    let title = ' â¤ï¸ æˆ‘ä¹Ÿæƒ³å¦³ï¼';
    let desc = 'æˆ‘çš„å¿ƒè·³è·Ÿå¦³åŒæ­¥äº†å–”~';
    let img = 'love.gif';
    if(type === 'happy') {
        m = 'ç¾åœ¨å¿ƒæƒ…å¾ˆå¥½ ğŸ˜Š ';
        title = ' ğŸ˜Š å¤ªæ£’äº†ï¼';
        desc = 'å¦³é–‹å¿ƒæˆ‘ä¹Ÿè·Ÿè‘—ä¸€èµ·é–‹å¿ƒï¼';
        img = 'happy.gif';
    }
    sendNotification('mood', `è‡­å¯¶ç¾åœ¨ï¼š${m}`);
    showModal(title, desc, img);
}

// è«‹æ±‚æ‰“é›»è©±é€šçŸ¥
function requestCall() {
    sendNotification('call', ' ğŸ“ è«‹æ±‚æ”¯æ´ï¼è‡­å¯¶æƒ³è¦ä½ æ‰“é›»è©±çµ¦å¥¹ï¼å¿«é»ï¼');
    alert("æ”¶åˆ°ï¼é¦¬ä¸Šæ‰“çµ¦å¦³ï¼Œä¸å“­å–”ï¼ â¤ï¸ ");
}

function closeComfort() {
    const video = document.getElementById('comfort-video');
    video.pause();
    document.getElementById('comfort-modal').style.display = 'none';
}

function toggleTask(num) {
    const idx = num - 1;
    const item = document.getElementById('t' + num);
    const cb = item.querySelector('input');
    tasks[idx] = cb.checked;
    cb.checked ? item.classList.add('done') : item.classList.remove('done');
    localStorage.setItem('tasks_state', JSON.stringify(tasks));
    const doneCount = tasks.filter(t => t).length;
    if(doneCount === 3 && localStorage.getItem('tasks_bonus_date') !== new Date().toDateString()) {
        addPoints(1);
        localStorage.setItem('tasks_bonus_date', new Date().toDateString());
        showModal(" ğŸ‰ ä»»å‹™å…¨é”æˆï¼", "ä»Šå¤©ä¹Ÿå¾ˆæ£’å–”ï¼Œç”œèœœ +1ï¼", "task_done.gif");
        sendNotification('task', 'ä»»å‹™å…¨é”æˆäº†ï¼');
    }
}

function resetTasksIfNewDay() {
    const today = new Date().toDateString();
    if(localStorage.getItem('last_task_date') !== today) {
        localStorage.removeItem('tasks_state');
        localStorage.removeItem('tasks_bonus_date');
        localStorage.setItem('last_task_date', today);
        tasks = [false, false, false];
    } else {
        const saved = JSON.parse(localStorage.getItem('tasks_state'));
        if(saved) {
            tasks = saved;
            tasks.forEach((status, i) => {
                if(status) {
                    const item = document.getElementById('t' + (i+1));
                    item.classList.add('done');
                    item.querySelector('input').checked = true;
                }
            });
        }
    }
}

function updatePointsDisplay() {
    let pts = parseInt(localStorage.getItem('pts_v3') || 0);
    document.getElementById('points').innerText = pts;
    document.getElementById('p-bar').style.width = Math.min((pts * 10), 100) + '%';
    const btn = document.getElementById('checkin-btn');

    if(pts >= 10) {
        btn.disabled = false;
        btn.innerText = " ğŸ é»æˆ‘å…Œæ›éš¨æ©Ÿé©šå–œ!!ï¼";
        btn.onclick = () => {
            // éš¨æ©Ÿçå‹µé‚è¼¯ (æ¬Šé‡)
            const rewards = [
                { title: " ğŸ’– å°ç¢ºå¹¸ï¼", desc: "ç²å¾—ã€Œæš–å¿ƒé£²æ–™å·ã€ï¼ ğŸ¤— ", img: "gift_drink.jpg", w: 30 },
                { title: " âœ¨ é©šå–œçï¼", desc: "æ»¿è¶³å¦³ä¸€å€‹å°é¡˜æœ›ï¼ˆé™æ™‚æœ‰æ•ˆ30hrï¼‰ï¼ ğŸ‘‘ ", img: "gift_wish.jpg", w: 20 },
                { title: " ğŸ• è¶…å¼·é‹ï¼", desc: "ç²å¾—ã€Œæ™šé£¯æˆ‘è«‹å®¢å·ã€ï¼ ğŸ´ ", img: "gift_food.jpg", w: 40 },
                { title: " ğŸ›’ çµ‚æ¥µå¤§çï¼", desc: "æ¸…ç©ºè³¼ç‰©è»Šï¼ˆé™ä¸€ä»¶ï¼‰ï¼ ğŸ’° ", img: "gift_dance.gif", w: 10 }
            ];

            let random = Math.random() * 100;
            let selected = rewards[0];
            let sum = 0;
            for (const r of rewards) {
                sum += r.w;
                if (random <= sum) { selected = r; break; }
            }

            showModal(selected.title, selected.desc, selected.img);
            
            // ã€é‚è¼¯ä¿®æ­£ã€‘æ‰£é™¤ 10 é»ï¼Œè€Œä¸æ˜¯æ­¸é›¶
            subtractPoints(10);
            
            sendNotification('gift', ` ğŸ‰ è‡­å¯¶å…Œæ›äº†ï¼š${selected.title} (${selected.desc})`);
            setTimeout(() => { updatePointsDisplay(); }, 500);
        };
    } else if(localStorage.getItem('last_date_v3') === new Date().toDateString()) {
        btn.disabled = true;
        btn.innerText = "ä»Šæ—¥å·²å®Œæˆç°½åˆ° âœ¨ ";
    } else {
        btn.disabled = false;
        btn.innerText = "æ¯æ—¥ç°½åˆ°é ˜é©šå–œ";
        btn.onclick = doCheckIn;
    }
}

// é€šç”¨çš„åŠ é»æ•¸
function addPoints(val) {
    let p = parseInt(localStorage.getItem('pts_v3') || 0);
    localStorage.setItem('pts_v3', p + val);
    updatePointsDisplay();
}

// ã€é‚è¼¯ä¿®æ­£ã€‘é€šç”¨çš„æ‰£é»æ•¸ (ä¸ä½æ–¼0)
function subtractPoints(val) {
    let p = parseInt(localStorage.getItem('pts_v3') || 0);
    let newScore = Math.max(0, p - val); // ç¢ºä¿ä¸æœƒè®Šè² æ•¸
    localStorage.setItem('pts_v3', newScore);
}

// ç°½åˆ°é‚è¼¯ï¼šå« 15% çˆ†æ“Š
function doCheckIn() {
    const isCritical = Math.random() < 0.15;
    const bonus = isCritical ? 2 : 1;
    
    addPoints(bonus);
    localStorage.setItem('last_date_v3', new Date().toDateString());
    
    if (isCritical) {
        showTip(" âœ¨ æ­æ°£çˆ†ç™¼ï¼ç”œèœœæš´æ“Š +2 ï¼", "#ff4757");
        sendNotification('checkin', 'è‡­å¯¶é‹æ°£è¶…å¥½ï¼è§¸ç™¼äº†ç°½åˆ°çˆ†æ“Š (+2)ï¼ âœ¨ ');
    } else {
        showTip("ç°½åˆ°æˆåŠŸï¼ç”œèœœ +1", "var(--main-pink)");
        sendNotification('checkin', 'è‡­å¯¶å‰›å‰›ç°½åˆ°å›‰ï¼ âœ¨ ');
    }
    
    updatePointsDisplay();
}

// ã€å¾Œç«¯æ¨¡æ“¬ã€‘ç•™è¨€æ¡†è¼¸å…¥ä»£ç¢¼åŠ åˆ†é‚è¼¯
function sendMessage() {
    const msgInput = document.getElementById('user-msg');
    const txt = msgInput.value.trim();
    
    if(!txt) return;

// --- ã€ä¸€æ¬¡æ€§å¯†é‘°ç³»çµ±ã€‘ ---
    // ä½ å¯ä»¥åœ¨é€™è£¡å®šç¾©å¤šçµ„å¯†é‘°ï¼Œæ¯å€‹å¯†é‘°å°æ‡‰ä¸åŒçš„åˆ†æ•¸
    const secretKeys = {
        '520': { id: 'key_2026_01', pts: 2, label: 'å•µå•µçš„æ„›æ„' },
        'missyou': { id: 'key_2026_02', pts: 3, label: 'æƒ³å¿µå¤§ç´…åŒ…' },
        'hug77': { id: 'key_2026_03', pts: 7, label: 'è¶…ç´šæŠ±æŠ±çå‹µ' }
    };

    if (secretKeys[txt]) {
        const keyData = secretKeys[txt];
        const usedKeys = JSON.parse(localStorage.getItem('used_promo_keys') || '[]');

        if (usedKeys.includes(keyData.id)) {
            alert(" ğŸ’¡ é€™å€‹å…Œæ›ç¢¼å·²ç¶“é ˜éå›‰ï¼Œä¸‹æ¬¡ç­‰å•µå•µç™¼æ–°çš„çµ¦ä½ ï¼");
        } else {
            addPoints(keyData.pts);
            usedKeys.push(keyData.id);
            localStorage.setItem('used_promo_keys', JSON.stringify(usedKeys));
            
            alert(` ğŸ’– æˆåŠŸå…Œæ›ã€${keyData.label}ã€‘ï¼ç”œèœœç©åˆ† +${keyData.pts}ï¼`);
            sendNotification('msg', ` ğŸ› ï¸ è‡­å¯¶ä½¿ç”¨äº†å¯†é‘°ï¼š${txt} (+${keyData.pts})`);
        }
        msgInput.value = '';
        return;
    }
    // --- ã€çµæŸã€‘ ---
    
    // å¦‚æœæ˜¯æ™®é€šç•™è¨€
    sendNotification('msg', ` ğŸ’Œ è‡­å¯¶ç•™è¨€ï¼š${txt}`);
    msgInput.value = '';
    const tip = document.getElementById('status-tip');
    tip.innerText = "å‚³é€æˆåŠŸ âœ¨ æˆ‘æ”¶åˆ°äº†å–”ï¼";
    tip.style.color = "var(--soft-blue)";
    tip.style.opacity = "1";
    setTimeout(() => { tip.style.opacity = "0"; }, 3000);
}

function showTip(text, color) {
    const tip = document.getElementById('status-tip');
    tip.innerText = text;
    tip.style.color = color;
    tip.style.opacity = "1";
    setTimeout(() => { tip.style.opacity = "0"; }, 3000);
}

function sendNotification(type, content) {
    fetch(`https://ntfy.sh/${TOPIC}/publish?message=${encodeURIComponent(content)}&title=MMBB2.2`).catch(e => {});
}

let cc = 0;
document.getElementById('greeting').onclick = () => {
    cc++;
    if(cc === 3) {
        localStorage.removeItem('last_date_v3');
        localStorage.removeItem('last_task_date');
        localStorage.removeItem('tasks_bonus_date');
        localStorage.removeItem('xmas_2025_viewed');
        addPoints(5);
        alert(" ğŸ› ï¸ æ¸¬è©¦æ¨¡å¼ï¼šå·²é‡ç½®ä¸¦ ç”œèœœ +5ï¼");
        location.reload();
    }
};

init();
</script>
</body>
</html>